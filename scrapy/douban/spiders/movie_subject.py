#!/usr/bin/env python
# -*- coding: utf-8 -*-

import random
import re
import string
import douban.database as db
from douban.items import Subject
from scrapy.linkextractors import LinkExtractor
from scrapy.spiders import CrawlSpider, Request, Rule


cursor = db.connection.cursor()

class MovieSubjectSpider(CrawlSpider):
    name = 'movie_subject'
    #allowed_domains = ['m.douban.com']
    start_urls = ['https://movie.douban.com/subject/1301645', 'https://movie.douban.com/subject/1301646', 'https://movie.douban.com/subject/1301646', 'https://movie.douban.com/subject/1301647', 'https://movie.douban.com/subject/1301648', 'https://movie.douban.com/subject/1301649', 'https://movie.douban.com/subject/1301650', 'https://movie.douban.com/subject/1301651', 'https://movie.douban.com/subject/1301652', 'https://movie.douban.com/subject/1301653', 'https://movie.douban.com/subject/1301654', 'https://movie.douban.com/subject/1301655', 'https://movie.douban.com/subject/1301656', 'https://movie.douban.com/subject/1301657', 'https://movie.douban.com/subject/1301658', 'https://movie.douban.com/subject/1301659', 'https://movie.douban.com/subject/1301660', 'https://movie.douban.com/subject/1301661', 'https://movie.douban.com/subject/1301662', 'https://movie.douban.com/subject/1301663', 'https://movie.douban.com/subject/1301664', 'https://movie.douban.com/subject/1301665', 'https://movie.douban.com/subject/1301666', 'https://movie.douban.com/subject/1301667', 'https://movie.douban.com/subject/1301668', 'https://movie.douban.com/subject/1301669', 'https://movie.douban.com/subject/1301670', 'https://movie.douban.com/subject/1301671', 'https://movie.douban.com/subject/1301672', 'https://movie.douban.com/subject/1301673', 'https://movie.douban.com/subject/1301674', 'https://movie.douban.com/subject/1301675', 'https://movie.douban.com/subject/1301676', 'https://movie.douban.com/subject/1301677', 'https://movie.douban.com/subject/1301678', 'https://movie.douban.com/subject/1301679', 'https://movie.douban.com/subject/1301680', 'https://movie.douban.com/subject/1301681', 'https://movie.douban.com/subject/1301682', 'https://movie.douban.com/subject/1301683', 'https://movie.douban.com/subject/1301684', 'https://movie.douban.com/subject/1301685', 'https://movie.douban.com/subject/1301686', 'https://movie.douban.com/subject/1301687', 'https://movie.douban.com/subject/1301688', 'https://movie.douban.com/subject/1301689', 'https://movie.douban.com/subject/1301690', 'https://movie.douban.com/subject/1301691', 'https://movie.douban.com/subject/1301692', 'https://movie.douban.com/subject/1301693', 'https://movie.douban.com/subject/1301694', 'https://movie.douban.com/subject/1301695', 'https://movie.douban.com/subject/1301696', 'https://movie.douban.com/subject/1301697', 'https://movie.douban.com/subject/1301698', 'https://movie.douban.com/subject/1301699', 'https://movie.douban.com/subject/1301700', 'https://movie.douban.com/subject/1301701', 'https://movie.douban.com/subject/1301702', 'https://movie.douban.com/subject/1301703', 'https://movie.douban.com/subject/1301704', 'https://movie.douban.com/subject/1301705', 'https://movie.douban.com/subject/1301706', 'https://movie.douban.com/subject/1301707', 'https://movie.douban.com/subject/1301708', 'https://movie.douban.com/subject/1301709', 'https://movie.douban.com/subject/1301710', 'https://movie.douban.com/subject/1301711', 'https://movie.douban.com/subject/1301712', 'https://movie.douban.com/subject/1301713', 'https://movie.douban.com/subject/1301714', 'https://movie.douban.com/subject/1301715', 'https://movie.douban.com/subject/1301716', 'https://movie.douban.com/subject/1301717', 'https://movie.douban.com/subject/1301718', 'https://movie.douban.com/subject/1301719', 'https://movie.douban.com/subject/1301720', 'https://movie.douban.com/subject/1301721', 'https://movie.douban.com/subject/1301722', 'https://movie.douban.com/subject/1301723', 'https://movie.douban.com/subject/1301724', 'https://movie.douban.com/subject/1301725', 'https://movie.douban.com/subject/1301726', 'https://movie.douban.com/subject/1301727', 'https://movie.douban.com/subject/1301728', 'https://movie.douban.com/subject/1301729', 'https://movie.douban.com/subject/1301730', 'https://movie.douban.com/subject/1301731', 'https://movie.douban.com/subject/1301732', 'https://movie.douban.com/subject/1301733', 'https://movie.douban.com/subject/1301734', 'https://movie.douban.com/subject/1301735', 'https://movie.douban.com/subject/1301736', 'https://movie.douban.com/subject/1301737', 'https://movie.douban.com/subject/1301738', 'https://movie.douban.com/subject/1301739', 'https://movie.douban.com/subject/1301740', 'https://movie.douban.com/subject/1301741', 'https://movie.douban.com/subject/1301742', 'https://movie.douban.com/subject/1301743', 'https://movie.douban.com/subject/1301744', 'https://movie.douban.com/subject/1301745', 'https://movie.douban.com/subject/1301746', 'https://movie.douban.com/subject/1301747', 'https://movie.douban.com/subject/1301748', 'https://movie.douban.com/subject/1301749', 'https://movie.douban.com/subject/1301750', 'https://movie.douban.com/subject/1301751', 'https://movie.douban.com/subject/1301752', 'https://movie.douban.com/subject/1301754', 'https://movie.douban.com/subject/1301755', 'https://movie.douban.com/subject/1301756', 'https://movie.douban.com/subject/1301757', 'https://movie.douban.com/subject/1301758', 'https://movie.douban.com/subject/1301759', 'https://movie.douban.com/subject/1301760', 'https://movie.douban.com/subject/1301761', 'https://movie.douban.com/subject/1301762', 'https://movie.douban.com/subject/1301763', 'https://movie.douban.com/subject/1301764', 'https://movie.douban.com/subject/1301765', 'https://movie.douban.com/subject/1301766', 'https://movie.douban.com/subject/1301767', 'https://movie.douban.com/subject/1301768', 'https://movie.douban.com/subject/1301769', 'https://movie.douban.com/subject/1301770', 'https://movie.douban.com/subject/1301771', 'https://movie.douban.com/subject/1301772', 'https://movie.douban.com/subject/1301773', 'https://movie.douban.com/subject/1301774', 'https://movie.douban.com/subject/1301775', 'https://movie.douban.com/subject/1301776', 'https://movie.douban.com/subject/1301777', 'https://movie.douban.com/subject/1301778', 'https://movie.douban.com/subject/1301779', 'https://movie.douban.com/subject/1301780', 'https://movie.douban.com/subject/1301781', 'https://movie.douban.com/subject/1301782', 'https://movie.douban.com/subject/1301783', 'https://movie.douban.com/subject/1301784', 'https://movie.douban.com/subject/1301785', 'https://movie.douban.com/subject/1301786', 'https://movie.douban.com/subject/1301787', 'https://movie.douban.com/subject/1301788', 'https://movie.douban.com/subject/1301789', 'https://movie.douban.com/subject/1301790', 'https://movie.douban.com/subject/1301791', 'https://movie.douban.com/subject/1301792', 'https://movie.douban.com/subject/1301793', 'https://movie.douban.com/subject/1301794', 'https://movie.douban.com/subject/1301795', 'https://movie.douban.com/subject/1301796', 'https://movie.douban.com/subject/1301797', 'https://movie.douban.com/subject/1301798', 'https://movie.douban.com/subject/1301799', 'https://movie.douban.com/subject/1301800', 'https://movie.douban.com/subject/1301801', 'https://movie.douban.com/subject/1301802', 'https://movie.douban.com/subject/1301803', 'https://movie.douban.com/subject/1301804', 'https://movie.douban.com/subject/1301805', 'https://movie.douban.com/subject/1301806', 'https://movie.douban.com/subject/1301807', 'https://movie.douban.com/subject/1301808', 'https://movie.douban.com/subject/1301809', 'https://movie.douban.com/subject/1301810', 'https://movie.douban.com/subject/1301811', 'https://movie.douban.com/subject/1301812', 'https://movie.douban.com/subject/1301813', 'https://movie.douban.com/subject/1301814', 'https://movie.douban.com/subject/1301815', 'https://movie.douban.com/subject/1301816', 'https://movie.douban.com/subject/1301817', 'https://movie.douban.com/subject/1301818', 'https://movie.douban.com/subject/1301819', 'https://movie.douban.com/subject/1301820', 'https://movie.douban.com/subject/1301821', 'https://movie.douban.com/subject/1301822', 'https://movie.douban.com/subject/1301823', 'https://movie.douban.com/subject/1301824', 'https://movie.douban.com/subject/1301825', 'https://movie.douban.com/subject/1301826', 'https://movie.douban.com/subject/1301827', 'https://movie.douban.com/subject/1301828', 'https://movie.douban.com/subject/1301829', 'https://movie.douban.com/subject/1301830', 'https://movie.douban.com/subject/1301831', 'https://movie.douban.com/subject/1301832', 'https://movie.douban.com/subject/1301833', 'https://movie.douban.com/subject/1301834', 'https://movie.douban.com/subject/1301835', 'https://movie.douban.com/subject/1301836', 'https://movie.douban.com/subject/1301837', 'https://movie.douban.com/subject/1301838', 'https://movie.douban.com/subject/1301839', 'https://movie.douban.com/subject/1301840', 'https://movie.douban.com/subject/1301841', 'https://movie.douban.com/subject/1301842', 'https://movie.douban.com/subject/1301843', 'https://movie.douban.com/subject/1301844', 'https://movie.douban.com/subject/1301845', 'https://movie.douban.com/subject/1301846', 'https://movie.douban.com/subject/1301847', 'https://movie.douban.com/subject/1301848', 'https://movie.douban.com/subject/1301849', 'https://movie.douban.com/subject/1301850', 'https://movie.douban.com/subject/1301851', 'https://movie.douban.com/subject/1301852', 'https://movie.douban.com/subject/1301853', 'https://movie.douban.com/subject/1301854', 'https://movie.douban.com/subject/1301855', 'https://movie.douban.com/subject/1301856', 'https://movie.douban.com/subject/1301857', 'https://movie.douban.com/subject/1301858', 'https://movie.douban.com/subject/1301859', 'https://movie.douban.com/subject/1301860', 'https://movie.douban.com/subject/1301861', 'https://movie.douban.com/subject/1301862', 'https://movie.douban.com/subject/1301863', 'https://movie.douban.com/subject/1301864', 'https://movie.douban.com/subject/1301866', 'https://movie.douban.com/subject/1301867', 'https://movie.douban.com/subject/1301868', 'https://movie.douban.com/subject/1301869', 'https://movie.douban.com/subject/1301870', 'https://movie.douban.com/subject/1301871', 'https://movie.douban.com/subject/1301872', 'https://movie.douban.com/subject/1301873', 'https://movie.douban.com/subject/1301874', 'https://movie.douban.com/subject/1301875', 'https://movie.douban.com/subject/1301876', 'https://movie.douban.com/subject/1301877', 'https://movie.douban.com/subject/1301878', 'https://movie.douban.com/subject/1301879', 'https://movie.douban.com/subject/1301880', 'https://movie.douban.com/subject/1301881', 'https://movie.douban.com/subject/1301882', 'https://movie.douban.com/subject/1301883', 'https://movie.douban.com/subject/1301884', 'https://movie.douban.com/subject/1301885', 'https://movie.douban.com/subject/1301886', 'https://movie.douban.com/subject/1301887', 'https://movie.douban.com/subject/1301888', 'https://movie.douban.com/subject/1301889', 'https://movie.douban.com/subject/1301890', 'https://movie.douban.com/subject/1301891', 'https://movie.douban.com/subject/1301892', 'https://movie.douban.com/subject/1301893', 'https://movie.douban.com/subject/1301894', 'https://movie.douban.com/subject/1301895', 'https://movie.douban.com/subject/1301896', 'https://movie.douban.com/subject/1301897', 'https://movie.douban.com/subject/1301898', 'https://movie.douban.com/subject/1301899', 'https://movie.douban.com/subject/1301900', 'https://movie.douban.com/subject/1301901', 'https://movie.douban.com/subject/1301902', 'https://movie.douban.com/subject/1301903', 'https://movie.douban.com/subject/1301904', 'https://movie.douban.com/subject/1301905', 'https://movie.douban.com/subject/1301906', 'https://movie.douban.com/subject/1301907', 'https://movie.douban.com/subject/1301908', 'https://movie.douban.com/subject/1301909', 'https://movie.douban.com/subject/1301910', 'https://movie.douban.com/subject/1301911', 'https://movie.douban.com/subject/1301912', 'https://movie.douban.com/subject/1301913', 'https://movie.douban.com/subject/1301914', 'https://movie.douban.com/subject/1301915', 'https://movie.douban.com/subject/1301916', 'https://movie.douban.com/subject/1301917', 'https://movie.douban.com/subject/1301918', 'https://movie.douban.com/subject/1301919', 'https://movie.douban.com/subject/1301920', 'https://movie.douban.com/subject/1301921', 'https://movie.douban.com/subject/1301922', 'https://movie.douban.com/subject/1301923', 'https://movie.douban.com/subject/1301924', 'https://movie.douban.com/subject/1301925', 'https://movie.douban.com/subject/1301926', 'https://movie.douban.com/subject/1301927', 'https://movie.douban.com/subject/1301928', 'https://movie.douban.com/subject/1301929', 'https://movie.douban.com/subject/1301930', 'https://movie.douban.com/subject/1301931', 'https://movie.douban.com/subject/1301932', 'https://movie.douban.com/subject/1301933', 'https://movie.douban.com/subject/1301934', 'https://movie.douban.com/subject/1301935', 'https://movie.douban.com/subject/1301936', 'https://movie.douban.com/subject/1301937', 'https://movie.douban.com/subject/1301938', 'https://movie.douban.com/subject/1301939', 'https://movie.douban.com/subject/1301940', 'https://movie.douban.com/subject/1301941', 'https://movie.douban.com/subject/1301942', 'https://movie.douban.com/subject/1301943', 'https://movie.douban.com/subject/1301944', 'https://movie.douban.com/subject/1301945', 'https://movie.douban.com/subject/1301946', 'https://movie.douban.com/subject/1301947', 'https://movie.douban.com/subject/1301948', 'https://movie.douban.com/subject/1301949', 'https://movie.douban.com/subject/1301950', 'https://movie.douban.com/subject/1301951', 'https://movie.douban.com/subject/1301952', 'https://movie.douban.com/subject/1301953', 'https://movie.douban.com/subject/1301954', 'https://movie.douban.com/subject/1301955', 'https://movie.douban.com/subject/1301956', 'https://movie.douban.com/subject/1301957', 'https://movie.douban.com/subject/1301958', 'https://movie.douban.com/subject/1301959', 'https://movie.douban.com/subject/1301960', 'https://movie.douban.com/subject/1301961', 'https://movie.douban.com/subject/1301962', 'https://movie.douban.com/subject/1301963', 'https://movie.douban.com/subject/1301964', 'https://movie.douban.com/subject/1301965', 'https://movie.douban.com/subject/1301966', 'https://movie.douban.com/subject/1301967', 'https://movie.douban.com/subject/1301968', 'https://movie.douban.com/subject/1301969', 'https://movie.douban.com/subject/1301970', 'https://movie.douban.com/subject/1301971', 'https://movie.douban.com/subject/1301972', 'https://movie.douban.com/subject/1301973', 'https://movie.douban.com/subject/1301974', 'https://movie.douban.com/subject/1301975', 'https://movie.douban.com/subject/1301976', 'https://movie.douban.com/subject/1301977', 'https://movie.douban.com/subject/1301978', 'https://movie.douban.com/subject/1301979', 'https://movie.douban.com/subject/1301980', 'https://movie.douban.com/subject/1301981', 'https://movie.douban.com/subject/1301982', 'https://movie.douban.com/subject/1301983', 'https://movie.douban.com/subject/1301984', 'https://movie.douban.com/subject/1301985', 'https://movie.douban.com/subject/1301986', 'https://movie.douban.com/subject/1301987', 'https://movie.douban.com/subject/1301988', 'https://movie.douban.com/subject/1301989', 'https://movie.douban.com/subject/1301990', 'https://movie.douban.com/subject/1301991', 'https://movie.douban.com/subject/1301992', 'https://movie.douban.com/subject/1301993', 'https://movie.douban.com/subject/1301994', 'https://movie.douban.com/subject/1301995', 'https://movie.douban.com/subject/1301996', 'https://movie.douban.com/subject/1301997', 'https://movie.douban.com/subject/1301998', 'https://movie.douban.com/subject/1301999', 'https://movie.douban.com/subject/1302000', 'https://movie.douban.com/subject/1302001', 'https://movie.douban.com/subject/1302002', 'https://movie.douban.com/subject/1302003', 'https://movie.douban.com/subject/1302004', 'https://movie.douban.com/subject/1302005', 'https://movie.douban.com/subject/1302006', 'https://movie.douban.com/subject/1302007', 'https://movie.douban.com/subject/1302008', 'https://movie.douban.com/subject/1302009', 'https://movie.douban.com/subject/1302010', 'https://movie.douban.com/subject/1302011', 'https://movie.douban.com/subject/1302012', 'https://movie.douban.com/subject/1302013', 'https://movie.douban.com/subject/1302014', 'https://movie.douban.com/subject/1302015', 'https://movie.douban.com/subject/1302016', 'https://movie.douban.com/subject/1302017', 'https://movie.douban.com/subject/1302018', 'https://movie.douban.com/subject/1302019', 'https://movie.douban.com/subject/1302020', 'https://movie.douban.com/subject/1302021', 'https://movie.douban.com/subject/1302022', 'https://movie.douban.com/subject/1302023', 'https://movie.douban.com/subject/1302024', 'https://movie.douban.com/subject/1302025', 'https://movie.douban.com/subject/1302026', 'https://movie.douban.com/subject/1302027', 'https://movie.douban.com/subject/1302028', 'https://movie.douban.com/subject/1302029', 'https://movie.douban.com/subject/1302030', 'https://movie.douban.com/subject/1302031', 'https://movie.douban.com/subject/1302032', 'https://movie.douban.com/subject/1302033', 'https://movie.douban.com/subject/1302034', 'https://movie.douban.com/subject/1302035', 'https://movie.douban.com/subject/1302036', 'https://movie.douban.com/subject/1302037', 'https://movie.douban.com/subject/1302038', 'https://movie.douban.com/subject/1302039', 'https://movie.douban.com/subject/1302040', 'https://movie.douban.com/subject/1302041', 'https://movie.douban.com/subject/1302042', 'https://movie.douban.com/subject/1302043', 'https://movie.douban.com/subject/1302044', 'https://movie.douban.com/subject/1302045', 'https://movie.douban.com/subject/1302046', 'https://movie.douban.com/subject/1302047', 'https://movie.douban.com/subject/1302048', 'https://movie.douban.com/subject/1302049', 'https://movie.douban.com/subject/1302050', 'https://movie.douban.com/subject/1302051', 'https://movie.douban.com/subject/1302052', 'https://movie.douban.com/subject/1302053', 'https://movie.douban.com/subject/1302054', 'https://movie.douban.com/subject/1302055', 'https://movie.douban.com/subject/1302056', 'https://movie.douban.com/subject/1302057', 'https://movie.douban.com/subject/1302058', 'https://movie.douban.com/subject/1302059', 'https://movie.douban.com/subject/1302060', 'https://movie.douban.com/subject/1302061', 'https://movie.douban.com/subject/1302062', 'https://movie.douban.com/subject/1302063', 'https://movie.douban.com/subject/1302064', 'https://movie.douban.com/subject/1302065', 'https://movie.douban.com/subject/1302066', 'https://movie.douban.com/subject/1302067', 'https://movie.douban.com/subject/1302068', 'https://movie.douban.com/subject/1302069', 'https://movie.douban.com/subject/1302070', 'https://movie.douban.com/subject/1302071', 'https://movie.douban.com/subject/1302072', 'https://movie.douban.com/subject/1302073', 'https://movie.douban.com/subject/1302074', 'https://movie.douban.com/subject/1302075', 'https://movie.douban.com/subject/1302076', 'https://movie.douban.com/subject/1302077', 'https://movie.douban.com/subject/1302078', 'https://movie.douban.com/subject/1302079', 'https://movie.douban.com/subject/1302080', 'https://movie.douban.com/subject/1302081', 'https://movie.douban.com/subject/1302082', 'https://movie.douban.com/subject/1302083', 'https://movie.douban.com/subject/1302084', 'https://movie.douban.com/subject/1302085', 'https://movie.douban.com/subject/1302086', 'https://movie.douban.com/subject/1302087', 'https://movie.douban.com/subject/1302088', 'https://movie.douban.com/subject/1302089', 'https://movie.douban.com/subject/1302090', 'https://movie.douban.com/subject/1302091', 'https://movie.douban.com/subject/1302092', 'https://movie.douban.com/subject/1302093', 'https://movie.douban.com/subject/1302094', 'https://movie.douban.com/subject/1302095', 'https://movie.douban.com/subject/1302096', 'https://movie.douban.com/subject/1302097', 'https://movie.douban.com/subject/1302098', 'https://movie.douban.com/subject/1302099', 'https://movie.douban.com/subject/1302100', 'https://movie.douban.com/subject/1302101', 'https://movie.douban.com/subject/1302102', 'https://movie.douban.com/subject/1302103', 'https://movie.douban.com/subject/1302104', 'https://movie.douban.com/subject/1302105', 'https://movie.douban.com/subject/1302106', 'https://movie.douban.com/subject/1302107', 'https://movie.douban.com/subject/1302108', 'https://movie.douban.com/subject/1302109', 'https://movie.douban.com/subject/1302110', 'https://movie.douban.com/subject/1302111', 'https://movie.douban.com/subject/1302112', 'https://movie.douban.com/subject/1302113', 'https://movie.douban.com/subject/1302114', 'https://movie.douban.com/subject/1302115', 'https://movie.douban.com/subject/1302116', 'https://movie.douban.com/subject/1302117', 'https://movie.douban.com/subject/1302118', 'https://movie.douban.com/subject/1302119', 'https://movie.douban.com/subject/1302120', 'https://movie.douban.com/subject/1302121', 'https://movie.douban.com/subject/1302122', 'https://movie.douban.com/subject/1302123', 'https://movie.douban.com/subject/1302124', 'https://movie.douban.com/subject/1302125', 'https://movie.douban.com/subject/1302126', 'https://movie.douban.com/subject/1302127', 'https://movie.douban.com/subject/1302128', 'https://movie.douban.com/subject/1302129', 'https://movie.douban.com/subject/1302130', 'https://movie.douban.com/subject/1302131', 'https://movie.douban.com/subject/1302132', 'https://movie.douban.com/subject/1302133', 'https://movie.douban.com/subject/1302134', 'https://movie.douban.com/subject/1302135', 'https://movie.douban.com/subject/1302136', 'https://movie.douban.com/subject/1302137', 'https://movie.douban.com/subject/1302138', 'https://movie.douban.com/subject/1302139', 'https://movie.douban.com/subject/1302140', 'https://movie.douban.com/subject/1302141', 'https://movie.douban.com/subject/1302142', 'https://movie.douban.com/subject/1302143', 'https://movie.douban.com/subject/1302144', 'https://movie.douban.com/subject/1302145', 'https://movie.douban.com/subject/1302146', 'https://movie.douban.com/subject/1302147', 'https://movie.douban.com/subject/1302148', 'https://movie.douban.com/subject/1302149', 'https://movie.douban.com/subject/1302150', 'https://movie.douban.com/subject/1302151', 'https://movie.douban.com/subject/1302152', 'https://movie.douban.com/subject/1302153', 'https://movie.douban.com/subject/1302154', 'https://movie.douban.com/subject/1302155', 'https://movie.douban.com/subject/1302156', 'https://movie.douban.com/subject/1302157', 'https://movie.douban.com/subject/1302158', 'https://movie.douban.com/subject/1302159', 'https://movie.douban.com/subject/1302160', 'https://movie.douban.com/subject/1302161', 'https://movie.douban.com/subject/1302162', 'https://movie.douban.com/subject/1302163', 'https://movie.douban.com/subject/1302164', 'https://movie.douban.com/subject/1302165', 'https://movie.douban.com/subject/1302166', 'https://movie.douban.com/subject/1302167', 'https://movie.douban.com/subject/1302168', 'https://movie.douban.com/subject/1302169', 'https://movie.douban.com/subject/1302170', 'https://movie.douban.com/subject/1302171', 'https://movie.douban.com/subject/1302172', 'https://movie.douban.com/subject/1302173', 'https://movie.douban.com/subject/1302174', 'https://movie.douban.com/subject/1302175', 'https://movie.douban.com/subject/1302176', 'https://movie.douban.com/subject/1302177', 'https://movie.douban.com/subject/1302178', 'https://movie.douban.com/subject/1302179', 'https://movie.douban.com/subject/1302180', 'https://movie.douban.com/subject/1302181', 'https://movie.douban.com/subject/1302182', 'https://movie.douban.com/subject/1302183', 'https://movie.douban.com/subject/1302184', 'https://movie.douban.com/subject/1302185', 'https://movie.douban.com/subject/1302186', 'https://movie.douban.com/subject/1302187', 'https://movie.douban.com/subject/1302188', 'https://movie.douban.com/subject/1302189', 'https://movie.douban.com/subject/1302190', 'https://movie.douban.com/subject/1302191', 'https://movie.douban.com/subject/1302192', 'https://movie.douban.com/subject/1302193', 'https://movie.douban.com/subject/1302194', 'https://movie.douban.com/subject/1302195', 'https://movie.douban.com/subject/1302196', 'https://movie.douban.com/subject/1302197', 'https://movie.douban.com/subject/1302198', 'https://movie.douban.com/subject/1302199', 'https://movie.douban.com/subject/1302200', 'https://movie.douban.com/subject/1302201', 'https://movie.douban.com/subject/1302202', 'https://movie.douban.com/subject/1302203', 'https://movie.douban.com/subject/1302204', 'https://movie.douban.com/subject/1302205', 'https://movie.douban.com/subject/1302206', 'https://movie.douban.com/subject/1302207', 'https://movie.douban.com/subject/1302208', 'https://movie.douban.com/subject/1302209', 'https://movie.douban.com/subject/1302210', 'https://movie.douban.com/subject/1302211', 'https://movie.douban.com/subject/1302212', 'https://movie.douban.com/subject/1302213', 'https://movie.douban.com/subject/1302214', 'https://movie.douban.com/subject/1302215', 'https://movie.douban.com/subject/1302216', 'https://movie.douban.com/subject/1302217', 'https://movie.douban.com/subject/1302218', 'https://movie.douban.com/subject/1302219', 'https://movie.douban.com/subject/1302220', 'https://movie.douban.com/subject/1302221', 'https://movie.douban.com/subject/1302222', 'https://movie.douban.com/subject/1302223', 'https://movie.douban.com/subject/1302224', 'https://movie.douban.com/subject/1302225', 'https://movie.douban.com/subject/1302226', 'https://movie.douban.com/subject/1302227', 'https://movie.douban.com/subject/1302228', 'https://movie.douban.com/subject/1302229', 'https://movie.douban.com/subject/1302230', 'https://movie.douban.com/subject/1302231', 'https://movie.douban.com/subject/1302232', 'https://movie.douban.com/subject/1302233', 'https://movie.douban.com/subject/1302234', 'https://movie.douban.com/subject/1302235', 'https://movie.douban.com/subject/1302236', 'https://movie.douban.com/subject/1302237', 'https://movie.douban.com/subject/1302238', 'https://movie.douban.com/subject/1302239', 'https://movie.douban.com/subject/1302240', 'https://movie.douban.com/subject/1302241', 'https://movie.douban.com/subject/1302243', 'https://movie.douban.com/subject/1302244', 'https://movie.douban.com/subject/1302245', 'https://movie.douban.com/subject/1302246', 'https://movie.douban.com/subject/1302247', 'https://movie.douban.com/subject/1302248', 'https://movie.douban.com/subject/1302249', 'https://movie.douban.com/subject/1302250', 'https://movie.douban.com/subject/1302251', 'https://movie.douban.com/subject/1302252', 'https://movie.douban.com/subject/1302253', 'https://movie.douban.com/subject/1302254', 'https://movie.douban.com/subject/1302255', 'https://movie.douban.com/subject/1302256', 'https://movie.douban.com/subject/1302257', 'https://movie.douban.com/subject/1302258', 'https://movie.douban.com/subject/1302259', 'https://movie.douban.com/subject/1302260', 'https://movie.douban.com/subject/1302261', 'https://movie.douban.com/subject/1302262', 'https://movie.douban.com/subject/1302263', 'https://movie.douban.com/subject/1302264', 'https://movie.douban.com/subject/1302265', 'https://movie.douban.com/subject/1302266', 'https://movie.douban.com/subject/1302267', 'https://movie.douban.com/subject/1302268', 'https://movie.douban.com/subject/1302269', 'https://movie.douban.com/subject/1302270', 'https://movie.douban.com/subject/1302271', 'https://movie.douban.com/subject/1302272', 'https://movie.douban.com/subject/1302273', 'https://movie.douban.com/subject/1302274', 'https://movie.douban.com/subject/1302275', 'https://movie.douban.com/subject/1302276', 'https://movie.douban.com/subject/1302277', 'https://movie.douban.com/subject/1302278', 'https://movie.douban.com/subject/1302279', 'https://movie.douban.com/subject/1302280', 'https://movie.douban.com/subject/1302281', 'https://movie.douban.com/subject/1302282', 'https://movie.douban.com/subject/1302283', 'https://movie.douban.com/subject/1302284', 'https://movie.douban.com/subject/1302285', 'https://movie.douban.com/subject/1302286', 'https://movie.douban.com/subject/1302287', 'https://movie.douban.com/subject/1302288', 'https://movie.douban.com/subject/1302289', 'https://movie.douban.com/subject/1302290', 'https://movie.douban.com/subject/1302291', 'https://movie.douban.com/subject/1302292', 'https://movie.douban.com/subject/1302293', 'https://movie.douban.com/subject/1302294', 'https://movie.douban.com/subject/1302295', 'https://movie.douban.com/subject/1302296', 'https://movie.douban.com/subject/1302297', 'https://movie.douban.com/subject/1302298', 'https://movie.douban.com/subject/1302299', 'https://movie.douban.com/subject/1302300', 'https://movie.douban.com/subject/1302301', 'https://movie.douban.com/subject/1302302', 'https://movie.douban.com/subject/1302303', 'https://movie.douban.com/subject/1302304', 'https://movie.douban.com/subject/1302305', 'https://movie.douban.com/subject/1302306', 'https://movie.douban.com/subject/1302307', 'https://movie.douban.com/subject/1302308', 'https://movie.douban.com/subject/1302309', 'https://movie.douban.com/subject/1302310', 'https://movie.douban.com/subject/1302311', 'https://movie.douban.com/subject/1302312', 'https://movie.douban.com/subject/1302313', 'https://movie.douban.com/subject/1302314', 'https://movie.douban.com/subject/1302315', 'https://movie.douban.com/subject/1302316', 'https://movie.douban.com/subject/1302317', 'https://movie.douban.com/subject/1302318', 'https://movie.douban.com/subject/1302319', 'https://movie.douban.com/subject/1302320', 'https://movie.douban.com/subject/1302321', 'https://movie.douban.com/subject/1302322', 'https://movie.douban.com/subject/1302323', 'https://movie.douban.com/subject/1302324', 'https://movie.douban.com/subject/1302325', 'https://movie.douban.com/subject/1302326', 'https://movie.douban.com/subject/1302327', 'https://movie.douban.com/subject/1302328', 'https://movie.douban.com/subject/1302329', 'https://movie.douban.com/subject/1302330', 'https://movie.douban.com/subject/1302331', 'https://movie.douban.com/subject/1302332', 'https://movie.douban.com/subject/1302333', 'https://movie.douban.com/subject/1302334', 'https://movie.douban.com/subject/1302335', 'https://movie.douban.com/subject/1302336', 'https://movie.douban.com/subject/1302337', 'https://movie.douban.com/subject/1302338', 'https://movie.douban.com/subject/1302339', 'https://movie.douban.com/subject/1302340', 'https://movie.douban.com/subject/1302341', 'https://movie.douban.com/subject/1302342', 'https://movie.douban.com/subject/1302343', 'https://movie.douban.com/subject/1302344', 'https://movie.douban.com/subject/1302345', 'https://movie.douban.com/subject/1302346', 'https://movie.douban.com/subject/1302347', 'https://movie.douban.com/subject/1302348', 'https://movie.douban.com/subject/1302349', 'https://movie.douban.com/subject/1302350', 'https://movie.douban.com/subject/1302351', 'https://movie.douban.com/subject/1302352', 'https://movie.douban.com/subject/1302353', 'https://movie.douban.com/subject/1302354', 'https://movie.douban.com/subject/1302355', 'https://movie.douban.com/subject/1302356', 'https://movie.douban.com/subject/1302357', 'https://movie.douban.com/subject/1302358', 'https://movie.douban.com/subject/1302359', 'https://movie.douban.com/subject/1302360', 'https://movie.douban.com/subject/1302361', 'https://movie.douban.com/subject/1302362', 'https://movie.douban.com/subject/1302363', 'https://movie.douban.com/subject/1302364', 'https://movie.douban.com/subject/1302365', 'https://movie.douban.com/subject/1302366', 'https://movie.douban.com/subject/1302367', 'https://movie.douban.com/subject/1302368', 'https://movie.douban.com/subject/1302369', 'https://movie.douban.com/subject/1302370', 'https://movie.douban.com/subject/1302371', 'https://movie.douban.com/subject/1302372', 'https://movie.douban.com/subject/1302373', 'https://movie.douban.com/subject/1302374', 'https://movie.douban.com/subject/1302375', 'https://movie.douban.com/subject/1302376', 'https://movie.douban.com/subject/1302377', 'https://movie.douban.com/subject/1302378', 'https://movie.douban.com/subject/1302379', 'https://movie.douban.com/subject/1302380', 'https://movie.douban.com/subject/1302381', 'https://movie.douban.com/subject/1302382', 'https://movie.douban.com/subject/1302383', 'https://movie.douban.com/subject/1302384', 'https://movie.douban.com/subject/1302385', 'https://movie.douban.com/subject/1302386', 'https://movie.douban.com/subject/1302387', 'https://movie.douban.com/subject/1302388', 'https://movie.douban.com/subject/1302389', 'https://movie.douban.com/subject/1302390', 'https://movie.douban.com/subject/1302391', 'https://movie.douban.com/subject/1302392', 'https://movie.douban.com/subject/1302393', 'https://movie.douban.com/subject/1302394', 'https://movie.douban.com/subject/1302395', 'https://movie.douban.com/subject/1302396', 'https://movie.douban.com/subject/1302397', 'https://movie.douban.com/subject/1302398', 'https://movie.douban.com/subject/1302399', 'https://movie.douban.com/subject/1302400', 'https://movie.douban.com/subject/1302401', 'https://movie.douban.com/subject/1302402', 'https://movie.douban.com/subject/1302403', 'https://movie.douban.com/subject/1302404', 'https://movie.douban.com/subject/1302405', 'https://movie.douban.com/subject/1302406', 'https://movie.douban.com/subject/1302407', 'https://movie.douban.com/subject/1302408', 'https://movie.douban.com/subject/1302409', 'https://movie.douban.com/subject/1302410', 'https://movie.douban.com/subject/1302411', 'https://movie.douban.com/subject/1302412', 'https://movie.douban.com/subject/1302413', 'https://movie.douban.com/subject/1302414', 'https://movie.douban.com/subject/1302415', 'https://movie.douban.com/subject/1302416', 'https://movie.douban.com/subject/1302417', 'https://movie.douban.com/subject/1302418', 'https://movie.douban.com/subject/1302419', 'https://movie.douban.com/subject/1302420', 'https://movie.douban.com/subject/1302421', 'https://movie.douban.com/subject/1302422', 'https://movie.douban.com/subject/1302423', 'https://movie.douban.com/subject/1302424', 'https://movie.douban.com/subject/1302426', 'https://movie.douban.com/subject/1302427', 'https://movie.douban.com/subject/1302428', 'https://movie.douban.com/subject/1302429', 'https://movie.douban.com/subject/1302430', 'https://movie.douban.com/subject/1302431', 'https://movie.douban.com/subject/1302432', 'https://movie.douban.com/subject/1302433', 'https://movie.douban.com/subject/1302434', 'https://movie.douban.com/subject/1302435', 'https://movie.douban.com/subject/1302436', 'https://movie.douban.com/subject/1302437', 'https://movie.douban.com/subject/1302438', 'https://movie.douban.com/subject/1302439', 'https://movie.douban.com/subject/1302440', 'https://movie.douban.com/subject/1302441', 'https://movie.douban.com/subject/1302442', 'https://movie.douban.com/subject/1302443', 'https://movie.douban.com/subject/1302444', 'https://movie.douban.com/subject/1302445', 'https://movie.douban.com/subject/1302446', 'https://movie.douban.com/subject/1302448', 'https://movie.douban.com/subject/1302449', 'https://movie.douban.com/subject/1302450', 'https://movie.douban.com/subject/1302451', 'https://movie.douban.com/subject/1302452', 'https://movie.douban.com/subject/1302453', 'https://movie.douban.com/subject/1302454', 'https://movie.douban.com/subject/1302455', 'https://movie.douban.com/subject/1302456', 'https://movie.douban.com/subject/1302457', 'https://movie.douban.com/subject/1302458', 'https://movie.douban.com/subject/1302459', 'https://movie.douban.com/subject/1302460', 'https://movie.douban.com/subject/1302461', 'https://movie.douban.com/subject/1302462', 'https://movie.douban.com/subject/1302463', 'https://movie.douban.com/subject/1302464', 'https://movie.douban.com/subject/1302465', 'https://movie.douban.com/subject/1302466', 'https://movie.douban.com/subject/1302467', 'https://movie.douban.com/subject/1302468', 'https://movie.douban.com/subject/1302469', 'https://movie.douban.com/subject/1302470', 'https://movie.douban.com/subject/1302471', 'https://movie.douban.com/subject/1302472', 'https://movie.douban.com/subject/1302473', 'https://movie.douban.com/subject/1302474', 'https://movie.douban.com/subject/1302475', 'https://movie.douban.com/subject/1302476', 'https://movie.douban.com/subject/1302477', 'https://movie.douban.com/subject/1302478', 'https://movie.douban.com/subject/1302479', 'https://movie.douban.com/subject/1302480', 'https://movie.douban.com/subject/1302481', 'https://movie.douban.com/subject/1302482', 'https://movie.douban.com/subject/1302483', 'https://movie.douban.com/subject/1302484', 'https://movie.douban.com/subject/1302485', 'https://movie.douban.com/subject/1302486', 'https://movie.douban.com/subject/1302487', 'https://movie.douban.com/subject/1302488', 'https://movie.douban.com/subject/1302489', 'https://movie.douban.com/subject/1302490', 'https://movie.douban.com/subject/1302491', 'https://movie.douban.com/subject/1302492', 'https://movie.douban.com/subject/1302493', 'https://movie.douban.com/subject/1302494', 'https://movie.douban.com/subject/1302495', 'https://movie.douban.com/subject/1302496', 'https://movie.douban.com/subject/1302497', 'https://movie.douban.com/subject/1302498', 'https://movie.douban.com/subject/1302499', 'https://movie.douban.com/subject/1302500', 'https://movie.douban.com/subject/1302501', 'https://movie.douban.com/subject/1302502', 'https://movie.douban.com/subject/1302503', 'https://movie.douban.com/subject/1302504', 'https://movie.douban.com/subject/1302505', 'https://movie.douban.com/subject/1302506', 'https://movie.douban.com/subject/1302507', 'https://movie.douban.com/subject/1302508', 'https://movie.douban.com/subject/1302509', 'https://movie.douban.com/subject/1302510', 'https://movie.douban.com/subject/1302511', 'https://movie.douban.com/subject/1302512', 'https://movie.douban.com/subject/1302513', 'https://movie.douban.com/subject/1302514', 'https://movie.douban.com/subject/1302515', 'https://movie.douban.com/subject/1302516', 'https://movie.douban.com/subject/1302517', 'https://movie.douban.com/subject/1302518', 'https://movie.douban.com/subject/1302519', 'https://movie.douban.com/subject/1302520', 'https://movie.douban.com/subject/1302521', 'https://movie.douban.com/subject/1302522', 'https://movie.douban.com/subject/1302523', 'https://movie.douban.com/subject/1302524', 'https://movie.douban.com/subject/1302525', 'https://movie.douban.com/subject/1302526', 'https://movie.douban.com/subject/1302527', 'https://movie.douban.com/subject/1302528', 'https://movie.douban.com/subject/1302529', 'https://movie.douban.com/subject/1302530', 'https://movie.douban.com/subject/1302531', 'https://movie.douban.com/subject/1302532', 'https://movie.douban.com/subject/1302533', 'https://movie.douban.com/subject/1302534', 'https://movie.douban.com/subject/1302535', 'https://movie.douban.com/subject/1302536', 'https://movie.douban.com/subject/1302537', 'https://movie.douban.com/subject/1302538', 'https://movie.douban.com/subject/1302539', 'https://movie.douban.com/subject/1302540', 'https://movie.douban.com/subject/1302541', 'https://movie.douban.com/subject/1302542', 'https://movie.douban.com/subject/1302543', 'https://movie.douban.com/subject/1302544', 'https://movie.douban.com/subject/1302545', 'https://movie.douban.com/subject/1302546', 'https://movie.douban.com/subject/1302547', 'https://movie.douban.com/subject/1302548', 'https://movie.douban.com/subject/1302549', 'https://movie.douban.com/subject/1302550', 'https://movie.douban.com/subject/1302551', 'https://movie.douban.com/subject/1302552', 'https://movie.douban.com/subject/1302553', 'https://movie.douban.com/subject/1302554', 'https://movie.douban.com/subject/1302555', 'https://movie.douban.com/subject/1302556', 'https://movie.douban.com/subject/1302557', 'https://movie.douban.com/subject/1302558', 'https://movie.douban.com/subject/1302559', 'https://movie.douban.com/subject/1302560', 'https://movie.douban.com/subject/1302561', 'https://movie.douban.com/subject/1302562', 'https://movie.douban.com/subject/1302563', 'https://movie.douban.com/subject/1302564', 'https://movie.douban.com/subject/1302565', 'https://movie.douban.com/subject/1302566', 'https://movie.douban.com/subject/1302567', 'https://movie.douban.com/subject/1302568', 'https://movie.douban.com/subject/1302569', 'https://movie.douban.com/subject/1302570', 'https://movie.douban.com/subject/1302571', 'https://movie.douban.com/subject/1302572', 'https://movie.douban.com/subject/1302573', 'https://movie.douban.com/subject/1302574', 'https://movie.douban.com/subject/1302575', 'https://movie.douban.com/subject/1302576', 'https://movie.douban.com/subject/1302577', 'https://movie.douban.com/subject/1302578', 'https://movie.douban.com/subject/1302579', 'https://movie.douban.com/subject/1302580', 'https://movie.douban.com/subject/1302581', 'https://movie.douban.com/subject/1302582', 'https://movie.douban.com/subject/1302583', 'https://movie.douban.com/subject/1302584', 'https://movie.douban.com/subject/1302585', 'https://movie.douban.com/subject/1302586', 'https://movie.douban.com/subject/1302587', 'https://movie.douban.com/subject/1302588', 'https://movie.douban.com/subject/1302589', 'https://movie.douban.com/subject/1302590', 'https://movie.douban.com/subject/1302591', 'https://movie.douban.com/subject/1302592', 'https://movie.douban.com/subject/1302593', 'https://movie.douban.com/subject/1302594', 'https://movie.douban.com/subject/1302595', 'https://movie.douban.com/subject/1302596', 'https://movie.douban.com/subject/1302597', 'https://movie.douban.com/subject/1302598', 'https://movie.douban.com/subject/1302599', 'https://movie.douban.com/subject/1302600', 'https://movie.douban.com/subject/1302601', 'https://movie.douban.com/subject/1302602', 'https://movie.douban.com/subject/1302603', 'https://movie.douban.com/subject/1302604', 'https://movie.douban.com/subject/1302605', 'https://movie.douban.com/subject/1302606', 'https://movie.douban.com/subject/1302607', 'https://movie.douban.com/subject/1302608', 'https://movie.douban.com/subject/1302609', 'https://movie.douban.com/subject/1302610', 'https://movie.douban.com/subject/1302611', 'https://movie.douban.com/subject/1302612', 'https://movie.douban.com/subject/1302613', 'https://movie.douban.com/subject/1302614', 'https://movie.douban.com/subject/1302615', 'https://movie.douban.com/subject/1302616', 'https://movie.douban.com/subject/1302617', 'https://movie.douban.com/subject/1302618', 'https://movie.douban.com/subject/1302619', 'https://movie.douban.com/subject/1302620', 'https://movie.douban.com/subject/1302621', 'https://movie.douban.com/subject/1302622', 'https://movie.douban.com/subject/1302623', 'https://movie.douban.com/subject/1302624', 'https://movie.douban.com/subject/1302625', 'https://movie.douban.com/subject/1302626', 'https://movie.douban.com/subject/1302627', 'https://movie.douban.com/subject/1302628', 'https://movie.douban.com/subject/1302629', 'https://movie.douban.com/subject/1302630', 'https://movie.douban.com/subject/1302631', 'https://movie.douban.com/subject/1302632', 'https://movie.douban.com/subject/1302633', 'https://movie.douban.com/subject/1302634', 'https://movie.douban.com/subject/1302635', 'https://movie.douban.com/subject/1302636', 'https://movie.douban.com/subject/1302637', 'https://movie.douban.com/subject/1302639', 'https://movie.douban.com/subject/1302640', 'https://movie.douban.com/subject/1302641', 'https://movie.douban.com/subject/1302642', 'https://movie.douban.com/subject/1302643', 'https://movie.douban.com/subject/1302644', 'https://movie.douban.com/subject/1302645', 'https://movie.douban.com/subject/1302646', 'https://movie.douban.com/subject/1302647', 'https://movie.douban.com/subject/1302648', 'https://movie.douban.com/subject/1302649', 'https://movie.douban.com/subject/1302650']
    #
    # rules定义进行内容页字段的提取规则
    # Link Extractor定义从爬取到的页面使用正则匹配提取以/ subject /开头、以subject-page结尾的豆瓣id，每一个爬取到的url页面数据使用callback解析
    # follow=True(跟进), 爬虫会在爬取的页面中再寻找符合规则的url，如此循环，直到把全站爬取完毕
    # , process_value = self.process_value
    def process_value(value):
        #print("dsmalvbnufeoabvfahucdsnajchdsauivbfahvudsahvufhave9faihvf0jvif")
        m=re.findall("\d+", value)
        if m:
            sql = 'SELECT id FROM subjects WHERE douban_id=%s' % m[0]
            #print(sql)
            cursor.execute(sql)
            exist = cursor.fetchone()
            if not exist:
                return value
            else:
                return None
        else:
            return None


    rules = (
        Rule(LinkExtractor(allow=('/subject/(\d).*subject-page$'),process_value = process_value),
             callback='parse_item', follow=True, process_request='cookie'),
    )


    def cookie(self, request):
        # 随机生成字符串
        bid = ''.join(random.choice(string.ascii_letters + string.digits) for x in range(11))
        request.cookies['bid'] = bid
        request = request.replace(url=request.url.replace('?', '/?'))
        return request


    # 构造将要爬的网页URL
    def start_requests(self):
        for url in self.start_urls:
            bid = ''.join(random.choice(string.ascii_letters + string.digits) for x in range(11))
            yield Request(url, cookies={'bid': bid})

    #正则匹配获取各网页id
    def get_douban_id(self, subject, response):
        subject['douban_id'] = re.search('\d+',response.url,re.M|re.I).group()
        return subject

    # 回调函数
    # 定义返回响应之后如何解析
    # 解析返回的数据(response data)，提取数据(生成item)以及生成需要进一步处理的URL的 Request 对象
    def parse_item(self, response):
        subject = Subject()
        self.get_douban_id(subject, response)
        subject['type'] = 'movie'
        return subject

